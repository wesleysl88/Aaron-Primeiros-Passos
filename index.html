<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aaron's First Steps (Final v5.3)</title>
    <style>
        body {
            margin: 0; padding: 0; overflow: hidden;
            background-color: #fdf6e3;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            touch-action: none; user-select: none; -webkit-user-select: none;
        }
        canvas { display: block; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 15px; box-sizing: border-box;
            z-index: 5;
        }
        
        .top-hud {
            display: flex; justify-content: space-between; align-items: flex-start; width: 100%;
        }
        .score-box {
            font-size: 24px; color: #5d5d5d; font-weight: bold;
            background: rgba(255,255,255,0.6); padding: 5px 15px; border-radius: 20px;
        }
        
        #lives-container { display: flex; gap: 5px; }
        .heart-icon {
            width: 32px; height: 32px;
            filter: drop-shadow(1px 1px 0 rgba(0,0,0,0.2));
            transition: opacity 0.2s;
        }

        #start-screen, #game-over-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.96);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            pointer-events: auto; text-align: center; z-index: 999;
        }
        
        .btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        
        button {
            border: none; padding: 15px 40px;
            font-size: 20px; font-weight: bold; color: white;
            border-radius: 50px; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s; font-family: inherit;
            min-width: 220px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        button:active { transform: translateY(4px); box-shadow: none; }

        .btn-easy { background: #81d4fa; }   
        .btn-normal { background: #ffb74d; } 
        .btn-hard { background: #e57373; }   

        .hidden { display: none !important; }

        #mobile-controls {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: space-between;
            padding: 0 20px; box-sizing: border-box;
            pointer-events: none; opacity: 0.6;
            z-index: 50;
        }
        .control-arrow {
            font-size: 50px; color: #888;
            background: rgba(255,255,255,0.8);
            width: 70px; height: 70px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border: 3px solid #ccc;
        }
    </style>
</head>
<body>

    <div id="ui-layer" class="hidden">
        <div class="top-hud">
            <div class="score-box">Distância: <span id="score">0</span>m</div>
            <div id="lives-container">
                <img id="life1" class="heart-icon">
                <img id="life2" class="heart-icon">
                <img id="life3" class="heart-icon">
            </div>
        </div>

        <div id="mobile-controls">
            <div class="control-arrow">⬅</div>
            <div class="control-arrow">➡</div>
        </div>
    </div>

    <div id="start-screen">
        <h1 style="color:#81d4fa; font-size: 40px; margin: 0;">Aaron's First Steps</h1>
        <img id="menu-avatar" style="width:100px; height:100px; margin: 10px;">
        <p style="color:#666; font-size: 16px;">Escolha a dificuldade:</p>
        
        <div class="btn-group">
            <button class="btn-easy" onclick="startGame('easy')" ontouchend="startGame('easy')">Fácil</button>
            <button class="btn-normal" onclick="startGame('normal')" ontouchend="startGame('normal')">Normal</button>
            <button class="btn-hard" onclick="startGame('hard')" ontouchend="startGame('hard')">Difícil</button>
        </div>
    </div>

    <div id="game-over-screen" class="hidden">
        <h1 style="color:#555;" id="game-over-title">Caiu!</h1>
        <p id="final-score" style="font-size: 28px; font-weight:bold; color: #5d5d5d;">0 metros</p>
        <button class="btn-easy" onclick="location.reload()" ontouchend="location.reload()">Voltar ao Menu</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/**
 * AARON'S FIRST STEPS - VERSÃO V5.3
 * - Correção: Modo Difícil agora com fallForce 0.04.
 * - Mobile Fix incluído.
 * - Aaron Fofo incluído.
 */

// --- 1. CONFIGURAÇÕES ---
const LEVELS = {
    easy: {
        lives: 3, spawnRate: 180, correction: 1.5, fallForce: 0.015, magnetTime: 120      
    },
    normal: {
        lives: 3, spawnRate: 140, correction: 1.5, fallForce: 0.03, magnetTime: 30       
    },
    hard: {
        lives: 1, 
        spawnRate: 70,       // Muitos obstáculos
        correction: 1.5, 
        fallForce: 0.04,     // AJUSTADO: Queda mais lenta conforme pedido (era 0.06)
        magnetTime: 30       
    }
};

let CURRENT_LEVEL = LEVELS.easy; 
let gameRunning = false; 

const STATE = {
    isPlaying: false, score: 0, frames: 0, lives: 3,
    aaronX: 0, angle: 0, forceDirection: 1, stabilityTimer: 0, isInvincible: false
};

// --- 2. SPRITES VETORIAIS ---
const SVG_SPRITES = {
    aaron: `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMzUgODAgQzM1IDkwIDQ1IDk1IDQ1IDg1IiBzdHJva2U9IiNmZmNjYWEiIHN0cm9rZS13aWR0aD0iOCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTY1IDgwIEM2NSA5MCA1NSA5NSA1NSA4NSIgc3Ryb2tlPSIjZmZjY2FhIiBzdHJva2Utd2lkdGg9IjgiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjxyZWN0IHg9IjI1IiB5PSI1MCIgd2lkdGg9IjUwIiBoZWlnaHQ9IjQwIiByeD0iMTUiIGZpbGw9IiM4MWQ0ZmEiIHN0cm9rZT0iIzQ1N2I5ZCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSIzNSIgcj0iMjgiIGZpbGw9IiNmZmNjYWEiIHN0cm9rZT0iIzU1NSIgc3Ryb2tlLXdpZHRoPSIyIi8+PGVsbGlwc2UgY3g9IjQwIiBjeT0iMzMiIHJ4PSIzLjUiIHJ5PSI1IiBmaWxsPSIjMzMzIi8+PGVsbGlwc2UgY3g9IjYwIiBjeT0iMzMiIHJ4PSIzLjUiIHJ5PSI1IiBmaWxsPSIjMzMzIi8+PGNpcmNsZSBjeD0iMzkiIGN5PSIzMSIgcj0iMS41IiBmaWxsPSJ3aGl0ZSIvPjxjaXJjbGUgY3g9IjU5IiBjeT0iMzEiIHI9IjEuNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNNDcgNDMgUTUwIDQ2IDUzIDQzIiBmaWxsPSJub25lIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PC9zdmc+`,
    heart: `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MCA0MCI+PHBhdGggZD0iTTIwIDM1IEMyMCAzNSAzNSAyNSAzNSAxNSBDMzUgNSAyNSA1IDIwIDEyIEMxNSA1IDUgNSA1IDE1IEM1IDI1IDIwIDM1IDIwIDM1IiBmaWxsPSIjZmY1YzhkIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iMiIvPjwvc3ZnPg==`,
    ball: `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MCA0MCI+PGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTgiIGZpbGw9IiNmZjk4MDAiIHN0cm9rZT0iIzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTIwIDIgQzIwIDIgMzAgMTAgMzAgMjAgQzMwIDMwIDIwIDM4IDIwIDM4IiBmaWxsPSJub25lIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ0PSJNMiAyMCBDMiAyMCAxMCAzMCAyMCAzMCBDMzAgMzAgMzggMjAgMzggMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+`,
    bear: `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2MCA2MCI+PGNpcmNsZSBjeD0iMTUiIGN5PSIxNSIgcj0iOCIgZmlsbD0iIzhkNmU2MyIgc3Ryb2tlPSIjM2QyNzIwIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSI0NSIgY3k9IjE1IiByPSI4IiBmaWxsPSIjOGQ2ZTYzIiBzdHJva2U9IiMzZDI3MjAiIHN0cm9rZS13aWR0aD0iMiIvPjxlbGxpcHNlIGN4PSIzMCIgY3k9IjQ1IiByeD0iMTgiIHJ5PSIxNCIgZmlsbD0iIzhkNmU2MyIgc3Ryb2tlPSIjM2QyNzIwIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSIzMCIgY3k9IjQ1IiByPSI4IiBmaWxsPSIjZDdjY2I4IiAvPjxjaXJjbGUgY3g9IjMwIiBjeT0iMjUiIHI9IjE2IiBmaWxsPSIjOGQ2ZTYzIiBzdHJva2U9IiMzZDI3MjAiIHN0cm9rZS13aWR0aD0iMiIvPjxlbGxpcHNlIGN4PSIzMCIgY3k9IjI4IiByeD0iNiIgcnk9IjUiIGZpbGw9IiNkN2NjYjgiIC8+PGNpcmNsZSBjeD0iMzAiIGN5PSIyNiIgcj0iMiIgZmlsbD0iIzNkMjcyMCIvPjxjaXJjbGUgY3g9IjI0IiBjeT0iMjIiIHI9IjEuNSIgZmlsbD0iIzMzMyIvPjxjaX